var t=Math.PI,e=2*t;function i(t){return function(e){return 1-t(1-e)}}function n(t){var e=i(t);return function(i){return i<.5?.5*t(2*i):.5+.5*e(2*i-1)}}var r=function(t){return t},o=function(t){return t*t},s=i(o),a=n(o),h=function(t){return t*t*t},l=i(h),u=n(h),c=function(t){return t*t*t*t},p=i(c),v=n(c),d=function(t){return t*t*t*t*t},f=i(d),y=n(d),x=function(e){return Math.sin(e*t*.5)},g=i(x),w=n(g),m=function(t){return Math.pow(2,-10*t)*Math.sin((t-.075)*e/.3)+1},P=i(m),b=n(P),T={easeLinear:r,easeInQuad:o,easeOutQuad:s,easeInOutQuad:a,easeInCub:h,easeOutCub:l,easeInOutCub:u,easeInQuart:c,easeOutQuart:p,easeInOutQuart:v,easeInQuint:d,easeOutQuint:f,easeInOutQuint:y,easeOutSin:x,easeInSin:g,easeInOutSin:w,easeOutElastic:m,easeInElastic:P,easeInOutElastic:b},S=function(){function t(t){this.value=null,this.value=t}return t.prototype.translate=function(t,e){return this.value[4]+=this.value[0]*t+this.value[2]*e,this.value[5]+=this.value[1]*t+this.value[3]*e,this},t.prototype.scale=function(t,e){return this.value[0]*=t,this.value[1]*=t,this.value[2]*=e,this.value[3]*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.value[0],r=this.value[1],o=this.value[2],s=this.value[3];return this.value[0]=n*e+o*i,this.value[1]=r*e+s*i,this.value[2]=o*e-n*i,this.value[3]=s*e-r*i,this},t.prototype.skewX=function(t){var e=Math.tan(t);return this.value[2]+=this.value[0]*e,this.value[3]+=this.value[1]*e,this},t.prototype.skewY=function(t){var e=Math.tan(t);return this.value[0]+=this.value[2]*e,this.value[1]+=this.value[3]*e,this},t.prototype.inverse=function(){var t=this.value[0],e=this.value[1],i=this.value[2],n=this.value[3],r=this.value[4],o=this.value[5],s=1/(t*n-i*e);return this.value[0]=n*s,this.value[1]=-e*s,this.value[2]=-i*s,this.value[3]=t*s,this.value[4]=(i*o-r*n)*s,this.value[5]=(r*e-t*o)*s,this},t.prototype.transform=function(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=this.value[0],h=this.value[1],l=this.value[2],u=this.value[3],c=this.value[4],p=this.value[5];return this.value[0]=a*e+l*i,this.value[1]=h*e+u*i,this.value[2]=a*n+l*r,this.value[3]=h*n+u*r,this.value[4]=a*o+l*s+c,this.value[5]=h*o+u*s+p,this},t.prototype.reset=function(){return this.value[0]=1,this.value[1]=0,this.value[2]=0,this.value[3]=1,this.value[4]=0,this.value[5]=0,this},t.prototype.set=function(t){return this.value[0]=t[0],this.value[1]=t[1],this.value[2]=t[2],this.value[3]=t[3],this.value[4]=t[4],this.value[5]=t[5],this},t.prototype.setTo=function(t){return t[0]=this.value[0],t[1]=this.value[1],t[2]=this.value[2],t[3]=this.value[3],t[4]=this.value[4],t[5]=this.value[5],this},t}(),k=[1,0,0,1,0,0];function C(t){return E(t.slice())}function E(t){return new S(t)}function I(t,e){t.tx=e[0]*t.x+e[2]*t.y+e[4],t.ty=e[1]*t.x+e[3]*t.y+e[5]}var z=Math.PI/180;var A=1/z,_=2*Math.PI;function D(t,e){return(t%e+e)%e}var M,O={CanvasMatrix2DTransformAPI:S,Identity:k,transformCopy2D:C,transform2D:E,transformPoint:I,rads:function(t){return D(t,360)*z},degs:function(t){return D(t,_)*A}},B=function(t,e){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function H(t,e){function i(){this.constructor=t}B(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function L(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{h(n.next(t))}catch(t){o(t)}}function a(t){try{h(n.throw(t))}catch(t){o(t)}}function h(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}h((n=n.apply(t,e||[])).next())})}function U(t,e){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function N(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}}function X(t){var e;if(Array.isArray(t))return(e=t).kind=M.JSON,e;if(!t.frames)throw new Error("Invalid spritesheet format.");return e=Array.isArray(t.frames)?{frames:t.frames,kind:M.JSON_TP_Array,meta:t.meta}:{frames:t.frames,kind:M.JSON_TP_Hash,meta:t.meta}}function R(t,e){return L(this,void 0,void 0,function(){var i,n,r,o,s,a,h,l,u,c,p,v,d,f,y,x,g,w,m,P,b,T,S,k,C,E,I,z,A,_;return U(this,function(D){switch(D.label){case 0:return h={},[4,t];case 1:return l=D.sent(),[4,e];case 2:switch(u=D.sent(),l.kind){case M.JSON:return[3,3];case M.JSON_TP_Array:return[3,12];case M.JSON_TP_Hash:return[3,21]}return[3,30];case 3:c=l,D.label=4;case 4:D.trys.push([4,9,10,11]),p=N(c),v=p.next(),D.label=5;case 5:return v.done?[3,8]:(d=h,f=(E=v.value).name,[4,createImageBitmap(u,E.x,E.y,E.width,E.height)]);case 6:d[f]=D.sent(),D.label=7;case 7:return v=p.next(),[3,5];case 8:return[3,11];case 9:return y=D.sent(),i={error:y},[3,11];case 10:try{v&&!v.done&&(n=p.return)&&n.call(p)}finally{if(i)throw i.error}return[7];case 11:return[3,30];case 12:x=l,D.label=13;case 13:D.trys.push([13,18,19,20]),g=N(x.frames),w=g.next(),D.label=14;case 14:return w.done?[3,17]:(P=h,b=(m=w.value).filename,[4,createImageBitmap(u,m.frame.x,m.frame.y,m.frame.w,m.frame.h)]);case 15:P[b]=D.sent(),D.label=16;case 16:return w=g.next(),[3,14];case 17:return[3,20];case 18:return T=D.sent(),r={error:T},[3,20];case 19:try{w&&!w.done&&(o=g.return)&&o.call(g)}finally{if(r)throw r.error}return[7];case 20:return[3,30];case 21:S=l,D.label=22;case 22:D.trys.push([22,27,28,29]),k=N(Object.keys(S.frames)),C=k.next(),D.label=23;case 23:return C.done?[3,26]:(I=S.frames[E=C.value],z=h,A=E,[4,createImageBitmap(u,I.frame.x,I.frame.y,I.frame.w,I.frame.h)]);case 24:z[A]=D.sent(),D.label=25;case 25:return C=k.next(),[3,23];case 26:return[3,29];case 27:return _=D.sent(),s={error:_},[3,29];case 28:try{C&&!C.done&&(a=k.return)&&a.call(k)}finally{if(s)throw s.error}return[7];case 29:return[3,30];case 30:return[2,h]}})})}!function(t){t[t.JSON=0]="JSON",t[t.JSON_TP_Hash=1]="JSON_TP_Hash",t[t.JSON_TP_Array=2]="JSON_TP_Array"}(M||(M={}));var Y,J,Q,V,j,K={get SpriteSheetKind(){return M},loadSpriteSheet:function(t,e){return L(this,void 0,void 0,function(){return U(this,function(i){switch(i.label){case 0:return[4,fetch(t,e)];case 1:return[4,i.sent().json()];case 2:return[2,X(i.sent())]}})})},createSpriteSheet:X,createTextureMap:R,loadImage:function(t,e){return L(this,void 0,void 0,function(){var i;return U(this,function(n){switch(n.label){case 0:return[4,fetch(t,e)];case 1:return[4,n.sent().blob()];case 2:return i=n.sent(),[2,createImageBitmap(i)]}})})}};function F(t,e){return t.z-e.z}!function(t){t.left="left",t.right="right",t.center="center",t.start="start",t.end="end"}(Y||(Y={})),function(t){t.top="top",t.hanging="hanging",t.middle="middle",t.alphabetic="alphabetic",t.ideographic="ideographic",t.bottom="bottom"}(J||(J={})),function(t){t[t.Playing=0]="Playing",t[t.Paused=1]="Paused",t[t.Stopped=2]="Stopped"}(Q||(Q={})),function(t){t.auto="auto",t.default="default",t.none="none",t["context-menu"]="context-menu",t.help="help",t.pointer="pointer",t.progress="progress",t.wait="wait",t.cell="cell",t.crosshair="crosshair",t.text="text",t["vertical-text"]="vertical-text",t.alias="alias",t.copy="copy",t.move="move",t["no-drop"]="no-drop",t["not-allowed"]="not-allowed",t["e-resize"]="e-resize",t["n-resize"]="n-resize",t["ne-resize"]="ne-resize",t["nw-resize"]="nw-resize",t["s-resize"]="s-resize",t["se-resize"]="se-resize",t["sw-resize"]="sw-resize",t["w-resize"]="w-resize",t["ew-resize"]="ew-resize",t["ns-resize"]="ns-resize",t["nesw-resize"]="nesw-resize",t["nwse-resize"]="nwse-resize",t["col-resize"]="col-resize",t["row-resize"]="row-resize",t["all-scroll"]="all-scroll",t["zoom-in"]="zoom-in",t["zoom-out"]="zoom-out",t.grab="grab",t.grabbing="grabbing"}(V||(V={})),function(t){t[t.Button=0]="Button",t[t.Character=1]="Character",t[t.Checkbox=2]="Checkbox",t[t.Close=3]="Close",t[t.Label=4]="Label",t[t.Panel=5]="Panel",t[t.Slider=6]="Slider",t[t.Textbox=7]="Textbox",t[t.TextInput=8]="TextInput",t[t.Sprite=9]="Sprite"}(j||(j={}));var G={zSort:F,get TextAlign(){return Y},get TextBaseline(){return J},get PlayState(){return Q},get Cursor(){return V},get SpriteType(){return j}},W=function(){function t(){this.callbacks=[]}return t.prototype.clear=function(){this.callbacks=[]},t.prototype.listen=function(t){var e=this;return this.callbacks.push(t),{dispose:function(){e.callbacks.includes(t)&&e.callbacks.splice(e.callbacks.indexOf(t),1)}}},t.prototype.promise=function(){var t=this;return new Promise(function(e,i){var n=t.listen(function(t){n.dispose(),e(t)})})},t.prototype.once=function(t){var e=this.listen(function(i){t(i),e.dispose()});return e},t.prototype.emit=function(t){var e,i;try{for(var n=N(this.callbacks.slice()),r=n.next();!r.done;r=n.next()){(0,r.value)(t)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}},t}(),Z=function(){function t(t){this.id="",this.type=j.Sprite,this.position=k.slice(),this.previousPosition=k.slice(),this.interpolatedPosition=k.slice(),this.inverse=k.slice(),this.alpha=1,this.interpolatedAlpha=1,this.previousAlpha=1,this.z=0,this.parent=null,this.container=null,this.wait=0,this.lastInterpolated=0,this.animationStart=0,this.ease=r,this.cursor=V.auto,this.animationLength=0,this.active=!1,this.hover=!1,this.down=!1,this.textures={},this.loaded=null,this.focused=!1,this.tabIndex=0,this.width=0,this.height=0,this.pointDownEvent=new W,this.pointUpEvent=new W,this.pointMoveEvent=new W,this.pointClickEvent=new W,this.keyDownEvent=new W,this.keyUpEvent=new W,this.loadedEvent=new W,this.textureChangeEvent=new W,this.id=t.id;var e=t.position||k.slice();this.textures=t.textures?t.textures:this.textures,E(this.position).set(e),E(this.previousPosition).set(e),E(this.interpolatedPosition).set(e),t.hasOwnProperty("alpha")&&(this.previousAlpha=this.alpha=this.interpolatedAlpha=t.alpha),t.hasOwnProperty("z")&&(this.z=t.z),t.source&&t.definition&&this.loadTexture(t.definition,t.source)}return t.prototype.broadPhase=function(t){return t.tx>=0&&t.tx<=this.width&&t.ty>=0&&t.ty<=this.height},t.prototype.narrowPhase=function(t){return this},t.prototype.pointCollision=function(t){return!0},t.prototype.isHovering=function(t,e){if(this.interpolate(e),I(t,this.inverse),this.broadPhase(t))return this.narrowPhase(t)},t.prototype.movePosition=function(t){var e=t.sx||0===t.sx?t.sx:t.s,i=t.sy||0===t.sy?t.sy:t.s;return this.move(C(k).translate(t.x||0,t.y||0).rotate(t.r||0).scale(0===e?0:e||1,0===i?0:i||1).translate(t.cx?-t.cx:0,t.cy?-t.cy:0).value)},t.prototype.move=function(t){return this.previousPosition[0]=this.interpolatedPosition[0],this.previousPosition[1]=this.interpolatedPosition[1],this.previousPosition[2]=this.interpolatedPosition[2],this.previousPosition[3]=this.interpolatedPosition[3],this.previousPosition[4]=this.interpolatedPosition[4],this.previousPosition[5]=this.interpolatedPosition[5],this.position[0]=t[0],this.position[1]=t[1],this.position[2]=t[2],this.position[3]=t[3],this.position[4]=t[4],this.position[5]=t[5],this},t.prototype.setAlpha=function(t){return this.previousAlpha=this.interpolatedAlpha,this.alpha=t,this},t.prototype.setZ=function(t){return this.z=t,this},t.prototype.over=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=this.ease),this.animationLength=t,this.animationStart=Date.now(),this.ease=i||this.ease,this.wait=e,this},t.prototype.skipAnimation=function(t){var e=t<this.animationLength+this.animationStart;return this.animationStart=t-this.animationLength,e},t.prototype.update=function(){},t.prototype.interpolate=function(t){if(!(t<=this.lastInterpolated)){this.lastInterpolated=t;var e=t-(this.animationStart+this.wait),i=e>=this.animationLength?1:e<=0?0:this.ease(e/this.animationLength);if(1===i)this.interpolatedPosition[0]=this.position[0],this.interpolatedPosition[1]=this.position[1],this.interpolatedPosition[2]=this.position[2],this.interpolatedPosition[3]=this.position[3],this.interpolatedPosition[4]=this.position[4],this.interpolatedPosition[5]=this.position[5],this.interpolatedAlpha=this.alpha;else if(0===i)this.interpolatedPosition[0]=this.previousPosition[0],this.interpolatedPosition[1]=this.previousPosition[1],this.interpolatedPosition[2]=this.previousPosition[2],this.interpolatedPosition[3]=this.previousPosition[3],this.interpolatedPosition[4]=this.previousPosition[4],this.interpolatedPosition[5]=this.previousPosition[5],this.interpolatedAlpha=this.previousAlpha;else{for(var n=0;n<6;n++)this.interpolatedPosition[n]=this.previousPosition[n]+i*(this.position[n]-this.previousPosition[n]);this.interpolatedAlpha=this.previousAlpha+i*(this.alpha-this.previousAlpha)}C(this.interpolatedPosition).inverse().setTo(this.inverse),this.parent&&(this.parent.interpolate(t),C(this.parent.inverse).transform(this.inverse).setTo(this.inverse))}},t.prototype.setTexture=function(t){return this.texture=t,this.width=this.textures[this.texture].width,this.height=this.textures[this.texture].height,this},t.prototype.render=function(t){t.drawImage(this.textures[this.texture],0,0)},t.prototype.loadTexture=function(t,e){return L(this,void 0,void 0,function(){var i,n,r,o;return U(this,function(s){switch(s.label){case 0:return i=this,[4,R(t,e)];case 1:return i.textures=s.sent(),r=(n=this.loadedEvent).emit,o={},[4,t];case 2:return o.definition=s.sent(),o.eventType="SpriteLoaded",o.source=this,[4,e];case 3:return r.apply(n,[(o.spriteSource=s.sent(),o.stage=this.container,o)]),[2]}})})},t}(),q=function(t){function e(e){var i=t.call(this,e)||this;return i.type=j.Button,i.selected=!1,i.font="monospace",i.fontColor="black",i.fontSize=12,i.text="",i.textAlign=Y.center,i.textBaseline=J.middle,i.selected=e.selected||!1,i.font=e.font||i.font,i.fontColor=e.fontColor||i.fontColor,i.fontSize=e.fontSize||i.fontSize,i.text=e.text||i.text,i.textAlign=e.textAlign,i.textBaseline=e.textBaseline,i}return H(e,t),e.prototype.update=function(){this.setTexture((this.active?"Active":"Inactive")+"_"+(this.hover?"Hover":"NoHover")+"_"+(this.selected?"Selected":"Unselected")),this.cursor=this.hover?V.pointer:V.auto,t.prototype.update.call(this)},e.prototype.render=function(e){t.prototype.render.call(this,e),e.translate(.5*this.textures[this.texture].width,.5*this.textures[this.texture].height),e.textBaseline=J.middle,e.textAlign=Y.center,e.font=this.fontSize+"px "+this.font,e.fillStyle=this.fontColor,e.fillText(this.text,0,0)},e.prototype.setText=function(t){return this.text=t,this},e}(Z),$=function(t){function e(e){var i=t.call(this,e)||this;return i.type=j.Character,i.name="",i.displayName="",i.color="",i.displayName=e.displayName,i.color=e.color,i}return H(e,t),e}(Z),tt=function(t){function e(e){var i=t.call(this,e)||this;return i.type=j.Checkbox,i.checked=!1,i.text="",i.font="monospace",i.fontColor="black",i.fontSize=12,i.textAlign=Y.left,i.textBaseline=J.middle,i.checkedChangeEvent=new W,i.checked=Boolean(e.checked)||!1,i.text=e.text||i.text,i.font=e.font||i.font,i.fontColor=e.fontColor||i.fontColor,i.textAlign=e.textAlign||i.textAlign,i.textBaseline=e.textBaseline||i.textBaseline,i}return H(e,t),e.prototype.toggle=function(){var t=this.checked;return this.checked=!this.checked,this.checkedChangeEvent.emit({eventType:"ValueChange",previousValue:t,property:"checked",source:this,stage:this.container,value:this.checked}),this},e.prototype.pointCollision=function(e){return e.clicked&&e.active===this&&this.toggle(),t.prototype.pointCollision.call(this,e)},e.prototype.render=function(e){t.prototype.render.call(this,e),e.translate(1.1*this.width,this.height/2),e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e.fillStyle=this.fontColor,e.font=this.fontSize+"px "+this.font,e.fillText(this.text,0,0)},e.prototype.update=function(){this.setTexture((this.active?"Active":"Inactive")+"_"+(this.hover?"Hover":"NoHover")+"_"+(this.checked?"Checked":"Unchecked")),this.cursor=this.hover?V.pointer:V.auto,t.prototype.update.call(this)},e.prototype.setText=function(t){return this.text=t,this},e}(Z),et=function(t){function e(e){var i=t.call(this,e)||this;return i.type=j.Close,i}return H(e,t),e.prototype.update=function(){this.setTexture((this.active?"Active":"Inactive")+"_"+(this.hover?"Hover":"NoHover")),this.cursor=this.hover?V.pointer:V.auto,t.prototype.update.call(this)},e}(Z),it=function(){function t(t){this.sprites=[],this.playables=[],this.points=[],this.audioContext=null,this.audioContext=t.audioContext||new AudioContext}return t.prototype.addSprite=function(t){return this.sprites.includes(t)||(this.sprites.push(t),t.container=this),this},t.prototype.removeSprite=function(t){return this.sprites.includes(t)&&(this.sprites.splice(this.sprites.indexOf(t),1),t.container=null),this},t.prototype.addPlayable=function(t){return this.playables.includes(t)||this.playables.push(t),this},t.prototype.removePlayable=function(t){return this.playables.includes(t)&&this.playables.splice(this.playables.indexOf(t),1),this},t.prototype.addPoint=function(t){return this.points.includes(t)||this.points.push(t),this},t.prototype.removePoint=function(t){return this.points.includes(t)&&this.points.splice(this.points.indexOf(t),1),this},t.prototype.getSpriteByID=function(t){var e,i;try{for(var n=N(this.sprites),r=n.next();!r.done;r=n.next()){var o=r.value;if(o.id===t)return o}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return null},t.prototype.getPointByID=function(t){var e,i;try{for(var n=N(this.points),r=n.next();!r.done;r=n.next()){var o=r.value;if(o.id===t)return o}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return null},t.prototype.getPlayableByID=function(t){var e,i;try{for(var n=N(this.playables),r=n.next();!r.done;r=n.next()){var o=r.value;if(o.id===t)return o}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return null},t}(),nt=function(t){function e(e){var i=t.call(this,e)||this;return i.canvas=null,i.ctx=null,i.touchPointIndex={},i.keyIndex={},i.mousePoint={active:null,captured:!1,clicked:!1,down:!1,firstDown:!1,hover:null,id:"mouse",tx:0,ty:0,type:"Mouse",x:0,y:0},i.pointDownEvent=new W,i.pointUpEvent=new W,i.pointMoveEvent=new W,i.mouseDownEvent=new W,i.mouseUpEvent=new W,i.mouseMoveEvent=new W,i.touchCancelEvent=new W,i.touchEndEvent=new W,i.touchMoveEvent=new W,i.touchStartEvent=new W,i.keyDownEvent=new W,i.keyUpEvent=new W,i.events=[{target:null,event:"mousedown",listener:function(t){return i.mouseDown(t)}},{target:document.body,event:"mouseup",listener:function(t){return i.mouseUp(t)}},{target:null,event:"mousemove",listener:function(t){return i.mouseMove(t)}},{target:null,event:"touchstart",listener:function(t){return i.touchStart(t)}},{target:document.body,event:"touchend",listener:function(t){return i.touchEnd(t)}},{target:null,event:"touchmove",listener:function(t){return i.touchMove(t)}},{target:document.body,event:"touchcancel",listener:function(t){return i.touchCancel(t)}}],i.keyboardEvents=[{target:document.body,event:"keydown",listener:function(t){return i.keyDown(t)}},{target:document.body,event:"keyup",listener:function(t){return i.keyUp(t)}}],i.canvas=e.canvas,i.canvas||(i.canvas=document.createElement("canvas"),document.body.appendChild(i.canvas)),i.canvas.width=e.width,i.canvas.height=e.height,i.ctx=i.canvas.getContext("2d"),i.hookEvents(),i.addPoint(i.mousePoint),i}return H(e,t),e.prototype.hookEvents=function(){var t=this;this.events.forEach(function(e){return(e.target||t.canvas).addEventListener(e.event,e.listener)}),this.keyboardEvents.forEach(function(e){return(e.target||t.canvas).addEventListener(e.event,e.listener)})},e.prototype.dispose=function(){var t=this;this.events.forEach(function(e){return(e.target||t.canvas).removeEventListener(e.event,e.listener)})},e.prototype.mouseDown=function(t){return this.mouseDownEvent.emit({down:!0,eventType:"MouseDown",rawEvent:t,source:this,stage:this,x:t.clientX,y:t.clientY}),this.pointDown(this.mousePoint,t)},e.prototype.mouseUp=function(t){return this.pointUp(this.mousePoint,t)},e.prototype.mouseMove=function(t){return this.pointMove(this.mousePoint,t)},e.prototype.touchStart=function(t){for(var e,i,n=0;n<t.changedTouches.length;n++)this.touchStartEvent.emit({down:!0,eventType:"TouchStart",rawEvent:t,source:this,stage:this,touch:e=t.changedTouches[n],x:e.clientX,y:e.clientY}),i=this.addTouchPoint(e),this.pointDown(i,e)},e.prototype.touchEnd=function(t){for(var e=null,i=0;i<t.changedTouches.length;i++)this.touchEndEvent.emit({down:!1,eventType:"TouchEnd",rawEvent:t,source:this,stage:this,touch:e=t.changedTouches[i],x:e.clientX,y:e.clientY}),this.pointUp(this.touchPointIndex[e.identifier],e),this.removeTouchPoint(e)},e.prototype.touchCancel=function(t){for(var e=null,i=0;i<t.changedTouches.length;i++)this.touchCancelEvent.emit({down:!1,eventType:"TouchCancel",rawEvent:t,source:this,stage:this,touch:e=t.changedTouches[i],x:null,y:null}),this.pointCancel(this.touchPointIndex[e.identifier],e),this.removeTouchPoint(e)},e.prototype.touchMove=function(t){for(var e=null,i=0;i<t.changedTouches.length;i++)this.touchMoveEvent.emit({down:!0,eventType:"TouchMove",rawEvent:t,source:this,stage:this,touch:e=t.changedTouches[i],x:e.clientX,y:e.clientY}),this.pointMove(this.touchPointIndex[e.identifier],e)},e.prototype.pointDown=function(t,e){var i=t.down;i||(t.down=!0,t.firstDown=!0);var n=t.x,r=t.y;this.pointMove(t,e),i||(t.hover&&(t.active=t.hover,t.active.down=!0,t.active.active=!0,this.setFocus(t.hover),t.active.pointDownEvent.emit({down:!0,eventType:"PointDown",point:t,previousX:n,previousY:r,source:t.active,stage:this,x:t.x,y:t.y})),this.pointDownEvent.emit({down:!0,eventType:"PointDown",point:t,previousX:n,previousY:r,source:t.active,stage:this,x:t.x,y:t.y}),t.firstDown=!1)},e.prototype.pointUp=function(t,e){var i=t.x,n=t.y,r=null;this.pointMove(t,e),t.down&&(t.down=!1,t.active&&(t.active.down=!1,t.active.active=!1,t.active.pointUpEvent.emit({down:!1,eventType:"PointUp",point:t,previousX:i,previousY:n,source:t.active,stage:this,x:t.x,y:t.x}),t.hover===t.active&&t.active.pointClickEvent.emit({down:!1,eventType:"PointClick",point:t,previousX:i,previousY:n,source:t.active,stage:this,x:t.x,y:t.x}),r=t.active,t.active=null),this.pointUpEvent.emit({down:!1,eventType:"PointUp",point:t,previousX:i,previousY:n,source:r||this,stage:this,x:t.x,y:t.x}))},e.prototype.pointMove=function(t,e){var i,n,r=Date.now(),o=this.canvas.getBoundingClientRect(),s=t.x,a=t.y;t.x=e.clientX-o.left,t.y=e.clientY-o.top,t.hover&&(t.hover.hover=!1,t.hover=null),this.sprites.sort(F);for(var h=this.sprites.length-1;h>=0;h--)if(n=(i=this.sprites[h]).isHovering(t,r)){n.hover=!0,t.hover=n,n.pointCollision(t),n.pointMoveEvent.emit({down:t.down,eventType:"PointMove",point:t,previousX:s,previousY:a,source:i,stage:this,x:t.x,y:t.y});break}this.pointMoveEvent.emit({down:t.down,eventType:"PointMove",point:t,previousX:s,previousY:a,source:i,stage:this,x:t.x,y:t.y})},e.prototype.pointCancel=function(t,e){t.active&&(t.active.active=!1,t.active=null),t.hover&&(t.hover.hover=!1,t.hover=null)},e.prototype.createInteractionPoint=function(t,e){return{active:null,captured:!1,clicked:!1,down:!1,firstDown:!1,hover:null,id:t,tx:0,ty:0,type:e,x:0,y:0}},e.prototype.addTouchPoint=function(t){var e=this.createInteractionPoint(t.identifier.toString(),"Touch");return this.addPoint(e),this.touchPointIndex[t.identifier]=e,e},e.prototype.removeTouchPoint=function(t){var e=this.touchPointIndex[t.identifier];delete this.touchPointIndex[t.identifier],this.removePoint(e)},e.prototype.hoverCheck=function(t){var e,i,n,r,o,s;try{for(var a=N(this.points),h=a.next();!h.done;h=a.next()){(o=h.value).hover&&(o.hover.hover=!1,o.hover=null);try{for(var l=N(this.sprites),u=l.next();!u.done;u=l.next())if((s=u.value).isHovering(o,t)){s.pointCollision(o),o.hover=s,s.hover=!0;break}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{h&&!h.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}},e.prototype.keyUp=function(t){this.keyUpEvent.emit({down:!1,eventType:"KeyUp",key:t.key,source:this,stage:this}),this.keyIndex[t.key]=!1},e.prototype.keyDown=function(t){var e,i;this.keyIndex[t.key]=!0,this.keyDownEvent.emit({down:!0,eventType:"KeyDown",key:t.key,source:this,stage:this});try{for(var n=N(this.sprites),r=n.next();!r.done;r=n.next()){var o=r.value;o.focused&&o.keyDownEvent.emit({down:!0,eventType:"KeyDown",key:t.key,source:o,stage:this})}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}},e.prototype.setFocus=function(t){var e,i;try{for(var n=N(this.sprites),r=n.next();!r.done;r=n.next()){var o=r.value;if(o.focused=o===t,o.type===j.Panel)o.focus(t)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}},e}(it),rt=document.createElement("canvas").getContext("2d"),ot=function(t){function e(e){var i=t.call(this,e)||this;return i.type=j.Label,i.text="",i.font="monospace",i.fontSize=12,i.fontColor="black",i.textAlign=Y.start,i.textBaseline=J.hanging,i.text=e.text||i.text,i.font=e.font||i.font,i.fontSize=e.fontSize||i.fontSize,i.fontColor=e.fontColor||i.fontColor,i.textBaseline=e.textBaseline||i.textBaseline,i.textAlign=e.textAlign||i.textAlign,i}return H(e,t),e.prototype.update=function(){this.height=this.fontSize,rt.font=this.fontSize+"px "+this.font,this.width=rt.measureText(this.text).width},e.prototype.render=function(t){t.textBaseline=this.textBaseline,t.textAlign=this.textAlign,t.font=this.fontSize+"px "+this.font,t.fillStyle=this.fontColor,t.fillText(this.text,0,0)},e.prototype.setText=function(t){return this.text=t,this},e}(Z),st=function(t,e){return t.z-e.z},at=function(t){function e(e){var i=t.call(this,e)||this;return i.type=j.Panel,i.sprites=[],i}return H(e,t),e.prototype.addSprite=function(t){return t.parent=this,this.sprites.push(t),this},e.prototype.interpolate=function(e){var i,n;if(!(e<=this.lastInterpolated)){t.prototype.interpolate.call(this,e);try{for(var r=N(this.sprites),o=r.next();!o.done;o=r.next()){o.value.interpolate(e)}}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}}},e.prototype.removeSprite=function(t){return this.sprites.includes(t)&&(this.sprites.splice(this.sprites.indexOf(t),1),t.parent=null),this},e.prototype.broadPhase=function(e){var i,n;this.sprites.sort(st);try{for(var r=N(this.sprites),o=r.next();!o.done;o=r.next()){var s=o.value;s.down=!1,s.hover=!1}}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return t.prototype.broadPhase.call(this,e)},e.prototype.narrowPhase=function(t){for(var e=null,i=null,n=this.sprites.length-1;n>=0;n--)if(I(t,(e=this.sprites[n]).inverse),e.broadPhase(t)&&(i=e.narrowPhase(t)))return i;return this},e.prototype.update=function(){var t,e;this.hover=!1;try{for(var i=N(this.sprites),n=i.next();!n.done;n=i.next()){var r=n.value;r.update(),r.hover&&(this.hover=r.hover,this.cursor=r.cursor)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},e.prototype.render=function(e){var i,n;t.prototype.render.call(this,e),e.beginPath(),e.rect(0,0,this.width,this.height),e.clip();try{for(var r=N(this.sprites),o=r.next();!o.done;o=r.next()){var s=o.value;e.save(),e.transform(s.interpolatedPosition[0],s.interpolatedPosition[1],s.interpolatedPosition[2],s.interpolatedPosition[3],s.interpolatedPosition[4],s.interpolatedPosition[5]),e.globalAlpha*=s.interpolatedAlpha,s.render(e),e.restore()}}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}},e.prototype.focus=function(t){var e,i;try{for(var n=N(this.sprites),r=n.next();!r.done;r=n.next()){var o=r.value;if(o.focused=o===t,o.type===j.Panel)o.focus(t)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}},e.prototype.skipAnimation=function(e){var i,n,r=t.prototype.skipAnimation.call(this,e);try{for(var o=N(this.sprites),s=o.next();!s.done;s=o.next()){r=s.value.skipAnimation(e)||r}}catch(t){i={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return r},e}(Z),ht=function(){function t(t){this.id="",this.started=0,this.length=0,this.start=0,this.end=0,this.loop=!1,this.state=Q.Stopped,this.id=t.id,this.context=t.context,this.definition=t.definition,this.start=this.definition.spritemap[t.texture].start,this.end=this.definition.spritemap[t.texture].end,this.length=this.end-this.start,this.gain=t.context.createGain(),this.loaded=this.createSource(t.source,t.context),this.destination=t.context.destination}return t.prototype.play=function(){var t=this;return this.loaded.then(function(e){return t.createPlayInstance()}),this},t.prototype.stop=function(){return this},t.prototype.pause=function(){return this},t.prototype.setVolume=function(t){if(t<0||t>1)throw new Error("setVolume() accepts a number between 0 and 1; got "+t+".");return this.gain.gain.value=t,this},t.prototype.createSource=function(t,e){return L(this,void 0,void 0,function(){var i,n;return U(this,function(r){switch(r.label){case 0:return[4,t];case 1:return[4,r.sent().arrayBuffer()];case 2:return i=r.sent(),n=this,[4,e.decodeAudioData(i)];case 3:return n.source=r.sent(),[2]}})})},t.prototype.createPlayInstance=function(){var t=this.context.createBufferSource();t.buffer=this.source,t.loop=this.loop,t.connect(this.gain),t.start(0,this.start,this.length);var e=this.gain;t.addEventListener("ended",function i(n){t.disconnect(e),t.removeEventListener("ended",i)})},t}(),lt=function(t){function e(e){var i=t.call(this,e)||this;return i.type=j.Slider,i.value=0,i.max=1,i.min=0,i.width=100,i.valueChangeEvent=new W,i.sliderPattern=null,i.pillTexture=null,i.height=e.textures.Pill_Hover.height,i.width=e.width,i.max=e.max||i.max,i.min=e.min||i.min,i.value=e.value||i.value,i.sliderPattern=document.createElement("canvas").getContext("2d").createPattern(e.textures.Line,"repeat-x"),i}return H(e,t),e.prototype.broadPhase=function(e){return!!this.active||t.prototype.broadPhase.call(this,e)},e.prototype.narrowPhase=function(t){if(this.active||t.firstDown)return this;var e=(this.width-this.textures.Pill_Hover.width)*((this.value-this.min)/(this.max-this.min));return t.ty<=this.textures.Pill_Hover.height&&t.ty>=0&&t.tx>=e&&t.tx<=e+this.textures.Pill_Hover.width?this:void 0},e.prototype.pointCollision=function(e){if(t.prototype.pointCollision.call(this,e),this.active&&e.active===this){var i=this.value,n=this.width-this.textures.Pill_Hover.width,r=Math.max(0,Math.min(e.tx-.5*this.textures.Pill_Hover.width,n));this.value=this.min+(this.max-this.min)*r/n,this.value!==i&&this.valueChangeEvent.emit({eventType:"ValueChange",previousValue:i,property:"value",source:this,stage:this.container,value:this.value})}return!0},e.prototype.update=function(){this.cursor=this.hover?V.pointer:V.auto,this.pillTexture=this.active?this.textures.Pill_Active:this.hover?this.textures.Pill_Hover:this.textures.Pill},e.prototype.render=function(t){t.drawImage(this.textures.Line_Cap_Left,0,0),t.drawImage(this.textures.Line_Cap_Right,this.width-this.textures.Line_Cap_Right.width,0),t.fillStyle=this.sliderPattern,t.fillRect(this.textures.Line_Cap_Left.width,0,this.width-this.textures.Line_Cap_Left.width-this.textures.Line_Cap_Right.width,this.textures.Line.height),t.drawImage(this.pillTexture,(this.width-this.textures.Pill_Hover.width)*((this.value-this.min)/(this.max-this.min)),0)},e}(Z),ut=function(t){function e(e){var i=t.call(this,e)||this;return i.postInterpolateEvent=new W,i.preInterpolateEvent=new W,i.preHoverCheckEvent=new W,i.postHoverCheckEvent=new W,i.preUpdateEvent=new W,i.postUpdateEvent=new W,i.preRenderEvent=new W,i.postRenderEvent=new W,i}return H(e,t),e.prototype.update=function(){var t,e,i,n,r=Date.now();this.preInterpolateEvent.emit({eventType:"PreInterpolate",source:this,stage:this});try{for(var o=N(this.sprites),s=o.next();!s.done;s=o.next())s.value.interpolate(r)}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}this.postInterpolateEvent.emit({eventType:"PostInterpolate",source:this,stage:this}),this.preHoverCheckEvent.emit({eventType:"PreHoverCheck",source:this,stage:this}),this.hoverCheck(r),this.postHoverCheckEvent.emit({eventType:"PostHoverCheck",source:this,stage:this}),this.preUpdateEvent.emit({eventType:"PreUpdate",source:this,stage:this});try{for(var a=N(this.sprites),h=a.next();!h.done;h=a.next())h.value.update()}catch(t){i={error:t}}finally{try{h&&!h.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return this.postUpdateEvent.emit({eventType:"PostUpdate",source:this,stage:this}),this},e.prototype.render=function(){var t,e,i;this.preRenderEvent.emit({eventType:"PreRender",source:this,stage:this});var n=V.auto,r=this.ctx;r.clearRect(0,0,this.canvas.width,this.canvas.height);try{for(var o=N(this.sprites),s=o.next();!s.done;s=o.next())i=s.value,r.save(),r.setTransform(i.interpolatedPosition[0],i.interpolatedPosition[1],i.interpolatedPosition[2],i.interpolatedPosition[3],i.interpolatedPosition[4],i.interpolatedPosition[5]),r.globalAlpha=i.interpolatedPosition[6],i.render(r),r.restore(),n=i.hover&&i.cursor||n}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return this.canvas.style.cursor=n,this.postRenderEvent.emit({eventType:"PostRender",source:this,stage:this}),this},e.prototype.skipAnimations=function(){var t,e,i=Date.now(),n=!1;try{for(var r=N(this.sprites),o=r.next();!o.done;o=r.next()){o.value.skipAnimation(i)&&(n=!0)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},e}(nt),ct=document.createElement("canvas").getContext("2d"),pt=function(t){function e(e){var i=t.call(this,e)||this;return i.type=j.Textbox,i.text="",i.textSpeed=1,i.textIndex=0,i.padding={bottom:5,left:5,right:5,top:5},i.fontSize=12,i.font="monospace",i.fontColor="black",i.lineHeight=16,i.textAlign=Y.left,i.textBaseline=J.hanging,i.interpolatedText=[""],i.text=e.text||i.text,i.textSpeed=e.textSpeed||i.textSpeed,e.hasOwnProperty("textIndex")&&(i.textIndex=e.textIndex),i.padding=e.padding||i.padding,i.fontSize=e.fontSize||i.fontSize,i.font=e.font||i.font,i.fontColor=e.fontColor||i.fontColor,i.lineHeight=e.lineHeight||i.lineHeight,i.setTexture("Texture"),i}return H(e,t),e.prototype.update=function(){var t,i,n=this.textures[this.texture].width-this.padding.left-this.padding.right;this.textIndex=Math.min(this.text.length,this.textIndex+this.textSpeed);var r=this.text.match(e.regex);this.interpolatedText=[""];var o=(this.textures[this.texture].height-this.padding.top-this.padding.bottom)/this.lineHeight,s="",a=0,h=this.textIndex;ct.font=this.fontSize+"px "+this.font;try{for(var l=N(r),u=l.next();!u.done;u=l.next()){var c=u.value;if("\n"!==c&&"\r\n"!==c&&"\r"!==c){if(s=this.interpolatedText[a],0===h)break;if(a+1>o)break;if(ct.measureText(s+=c).width>n&&(a=this.interpolatedText.push("")-1),this.interpolatedText[a]+=c,(h-=c.length)<0){this.interpolatedText[a]=this.interpolatedText[a].slice(0,h);break}}else this.interpolatedText.push(""),h-=c.length,a+=1}}catch(e){t={error:e}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(t)throw t.error}}},e.prototype.render=function(e){var i,n;t.prototype.render.call(this,e);var r=this.textures[this.texture].height-this.padding.top,o=this.padding.top;e.font=this.fontSize+"px "+this.font,e.fillStyle=this.fontColor,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e.beginPath(),e.rect(this.padding.left,this.padding.bottom,this.width-this.padding.right,this.height-this.padding.top),e.clip();try{for(var s=N(this.interpolatedText),a=s.next();!a.done;a=s.next()){if(o+this.fontSize>r)break;e.fillText(a.value,this.padding.left,o),o+=this.lineHeight}}catch(t){i={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}},e.prototype.setText=function(t){return t.startsWith(this.text)?(this.text=t,this):(this.text=t,this.interpolatedText=[""],this.textIndex=0,this)},e.prototype.appendText=function(t){return this.text+=t,this},e.prototype.skipAnimation=function(e){var i=t.prototype.skipAnimation.call(this,e)&&this.textIndex<this.text.length;return this.textIndex=this.text.length,i},e.regex=/\r\n|\r|\n|[^\t ]*[\t ]?/g,e}(Z),vt=document.createElement("canvas").getContext("2d"),dt=function(t){function e(e){var i=t.call(this,e)||this;return i.type=j.TextInput,i.text="",i.font="monospace",i.fontSize=12,i.fontColor="black",i.caretIndex=0,i.caretX=0,i.selection=[0,0],i.textScroll=0,i.padding=[2,2,2,2],i.frameCount=0,i.showCaret=!0,i.text=e.text||i.text,i.font=e.font||i.font,i.fontSize=e.fontSize||i.fontSize,i.fontColor=e.fontColor||i.fontColor,i.width=e.width||i.width,i.height=e.height||i.height,i}return H(e,t),e.prototype.update=function(){vt.font=this.fontSize+"px "+this.font;vt.measureText(this.text);this.caretX=vt.measureText(this.text.slice(0,this.caretIndex)).width;var t=this.caretX+this.textScroll,e=this.width-this.padding[0]-this.padding[1];t<0?(console.log("hit less than 0"),this.textScroll+=t):t>e&&(console.log("hit greater than"),this.textScroll-=t-e),this.frameCount+=1,this.frameCount>=30&&(this.frameCount=0,this.showCaret=!this.showCaret)},e.prototype.render=function(t){if(t.fillStyle="black",t.lineWidth=1,t.strokeRect(0,0,this.width,this.height),t.beginPath(),t.rect(this.padding[0],this.padding[2],this.width-this.padding[1]-this.padding[0],this.width-this.padding[3]),t.clip(),t.font=this.fontSize+"px "+this.font,t.fillStyle=this.fontColor,t.textBaseline=J.top,t.fillText(this.text,this.textScroll+this.padding[0],0),this.showCaret){var e=this.textScroll+this.padding[0]+this.caretIndex;t.beginPath(),t.moveTo(e,this.padding[2]),t.lineTo(e,this.height-this.padding[3]),t.stroke()}},e.prototype.setText=function(t){return this.text=t,this},e}(Z);export{O as Matrix,T as Ease,G as Util,K as Spritesheet,q as Button,$ as Character,tt as Checkbox,et as Close,it as Container,nt as InteractionManager,ot as Label,at as Panel,ht as SFXSprite,lt as Slider,Z as Sprite,ut as Stage,pt as Textbox,dt as TextInput};
//# sourceMappingURL=senpai-stage.mjs.map
